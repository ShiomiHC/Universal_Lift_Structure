<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 文件意图：控制器建筑的 Def 定义。 -->

    <!-- 抽象基类意图：统一指定 thingClass=Universal_Lift_Structure.Building_WallController，并设置为 isEdifice=false 以允许与结构共格；同时允许覆盖墙放置（canPlaceOverWall / isPlaceOverableWall）。 -->
    <ThingDef ParentName="BuildingBase" Name="ULS_WallControllerBase" Abstract="True">
        <!-- 逻辑类 -->
        <thingClass>Universal_Lift_Structure.Building_WallController</thingClass>
        <!-- 建筑分类 -->
        <category>Building</category>

        <!--
          重要：升降中间态需要 Tick 推进。
          控制器本体默认可能为 Never，从而导致升/降过程永远不结束。
        -->
        <tickerType>Normal</tickerType>
        <!-- 需求地形 -->
        <terrainAffordanceNeeded>Heavy</terrainAffordanceNeeded>
        <!-- 绘制：电缆层 -->
        <altitudeLayer>Conduits</altitudeLayer>
        <!-- 不可旋转 -->
        <rotatable>false</rotatable>
        <!-- 贴图 -->
        <graphicData>
            <texPath>Things/Building/Linked/ULS_WallController_Atlas</texPath>
            <graphicClass>Graphic_Single</graphicClass>
            <!-- 连接 -->
            <linkType>Basic</linkType>
            <!-- 连接标志-->
            <linkFlags>
                <li>Custom4</li>
            </linkFlags>
        </graphicData>
        <!-- UI 图标 -->
        <useSameGraphicForGhost>false</useSameGraphicForGhost>
        <uiIconPath>Things/Building/Linked/ULS_WallController_Icon</uiIconPath>
        <!-- 建筑节点设置 -->
        <building>
            <blueprintGraphicData>
                <texPath>Things/Building/Linked/ULS_WallController_BP_Atlas</texPath>
                <graphicClass>Graphic_Single</graphicClass>
            </blueprintGraphicData>
            <!-- 非主体结构 -->
            <isEdifice>false</isEdifice>
            <!-- 允许覆盖结构放置 -->
            <canPlaceOverWall>true</canPlaceOverWall>
            <!-- 允许作为结构上的叠放对象 -->
            <isPlaceOverableWall>true</isPlaceOverableWall>
        </building>
    </ThingDef>

    <!-- 实体 Def 意图：控制器实体 Def：占位贴图与 UI 图标、通行/不填充体积以共格、建造类别与造价/耐久等基础数值。
         注意：<label/>、<description/> 留空，显示文本由 Languages/ChineseSimplified/DefInjected 提供。
         〇：部分数值（如造价/耐久/WorkToBuild）当前为开发测试占位，后续可调优。 -->
    <ThingDef ParentName="ULS_WallControllerBase">
        <defName>ULS_WallController</defName>
        <!-- 名称留空，使用本地化 -->
        <label/>
        <!-- 描述留空，使用本地化 -->
        <description/>
        <!-- 尺寸 -->
        <size>(1,1)</size>
        <!-- 工作量/耐久/燃烧/价值 -->
        <statBases>
            <WorkToBuild>400</WorkToBuild>
            <MaxHitPoints>200</MaxHitPoints>
            <Flammability>0.1</Flammability>
            <MarketValue>50</MarketValue>
        </statBases>
        <comps>
            <!-- 电力：待机 1W -->
            <li Class="CompProperties_Power">
                <compClass>CompPowerTrader</compClass>
                <basePowerConsumption>1</basePowerConsumption>
            </li>
            <!-- flick 触发器：用于 Manual/Console 模式下走原版 flick 自动派工链路；Pulse 版本隐藏开关 Gizmo。 -->
            <li Class="Universal_Lift_Structure.ULS_Properties_FlickablePulse"/>
            <li Class="Universal_Lift_Structure.CompProperties_ULS_FlickTrigger"/>
        </comps>
        <!-- 造价 -->
        <costList>
            <Steel>30</Steel>
            <ComponentIndustrial>1</ComponentIndustrial>
        </costList>
        <!-- 建筑菜单类别：结构 -->
        <designationCategory>Structure</designationCategory>
        <!-- 填充样式：2D -->
        <drawStyleCategory>Default2D</drawStyleCategory>
        <!-- 放置规则 -->
        <placeWorkers>
            <li>Universal_Lift_Structure.ULS_PlaceRule_WallController</li>
        </placeWorkers>
        <!-- 绘制方式：仅地图网格 -->
        <drawerType>MapMeshOnly</drawerType>
    </ThingDef>

    <!-- 自动控制器 Def 意图：结构控制器（自动）。
         行为：当（过滤器匹配的）Pawn 接近该组任意控制器时自动“降下/收纳(开)”；离开后延迟自动“升起/放出(关)”。
         过滤器：由控制器 Gizmo 按组切换（敌方/友方/中立）；本 Def 中的 autoGroupType 仅作为“新组默认值”。
         注意：自动组与手动组禁止混组。 -->
    <ThingDef ParentName="ULS_WallControllerBase">
        <defName>ULS_WallController_Auto</defName>
        <!-- 名称留空，使用本地化 -->
        <label/>
        <!-- 描述留空，使用本地化 -->
        <description/>
        <!-- 贴图 -->
        <graphicData>
            <texPath>Things/Building/Linked/ULS_WallController_Atlas</texPath>
            <graphicClass>Graphic_Single</graphicClass>
            <drawSize>(1,1)</drawSize>
            <!-- 连接类型：基础 4x4 Atlas -->
            <linkType>Basic</linkType>
            <!-- 连接标志：使用 Custom4 避免与原版电缆自动连接，但允许同类连接 -->
            <linkFlags>
                <li>Custom4</li>
            </linkFlags>
        </graphicData>
        <!-- UI 图标 -->
        <uiIconPath>Things/Building/Linked/ULS_WallController_Icon</uiIconPath>
        <!-- 尺寸 -->
        <size>(1,1)</size>
        <!-- 数值沿用基础控制器 -->
        <statBases>
            <WorkToBuild>400</WorkToBuild>
            <MaxHitPoints>200</MaxHitPoints>
            <Flammability>0.1</Flammability>
            <MarketValue>50</MarketValue>
        </statBases>
        <comps>
            <!-- 电力：待机 5W，升降耗电由代码控制（开启功能时按每控制器+100W）。 -->
            <li Class="CompProperties_Power">
                <compClass>CompPowerTrader</compClass>
                <basePowerConsumption>5</basePowerConsumption>
            </li>
            <!-- flick 触发器：保留以兼容当前 Remote/Console/Manual 模式按钮逻辑。 -->
            <li Class="Universal_Lift_Structure.ULS_Properties_FlickablePulse"/>
            <li Class="Universal_Lift_Structure.CompProperties_ULS_FlickTrigger"/>

            <!-- 自动组标记：MapComponent 将按组扫描并执行自动开闭。 -->
            <li Class="Universal_Lift_Structure.CompProperties_ULS_AutoGroupMarker">
                <!-- 默认过滤器：友方/我方（Faction!=null 且非敌对）。玩家可在 Gizmo 中按组改为 敌方/中立。 -->
                <autoGroupType>Friendly</autoGroupType>
                <!-- 扫描半径：方形 5x5（包含自身） -->
                <maxRadius>2</maxRadius>
                <!-- 扫描间隔：60 tick（1x≈1次/秒） -->
                <checkIntervalTicks>60</checkIntervalTicks>
                <!-- 升起延迟：目标离开后延迟一段时间再升起，避免路过抖动 -->
                <closeDelayTicks>120</closeDelayTicks>
                <!-- 开闭冷却：避免失败场景反复触发 -->
                <toggleCooldownTicks>60</toggleCooldownTicks>
            </li>
        </comps>
        <!-- 造价 -->
        <costList>
            <Steel>30</Steel>
            <ComponentIndustrial>1</ComponentIndustrial>
        </costList>
        <!-- 建筑菜单类别：结构 -->
        <designationCategory>Structure</designationCategory>
        <!-- 填充样式：2D -->
        <drawStyleCategory>Default2D</drawStyleCategory>
        <!-- 放置规则 -->
        <placeWorkers>
            <li>Universal_Lift_Structure.ULS_PlaceRule_WallController</li>
        </placeWorkers>
        <!-- 绘制方式：仅地图网格 -->
        <drawerType>MapMeshOnly</drawerType>
    </ThingDef>
    <!-- 状态定义 收纳物价值叠加 -->
    <StatDef>
        <defName>ULS_StoredThingMarketValueIgnoreHp</defName>
        <label>财富值</label>
        <alwaysHide>true</alwaysHide>
        <workerClass>StatWorker</workerClass>
        <category>Building</category>
        <displayPriorityInCategory>10</displayPriorityInCategory>
        <parts>
            <li Class="Universal_Lift_Structure.ULS_StatPart_StoredMarketValue"/>
        </parts>
    </StatDef>

</Defs>