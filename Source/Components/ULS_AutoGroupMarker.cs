namespace Universal_Lift_Structure;

// ============================================================
// 【自动分组类型枚举】
// ============================================================
// 定义自动分组的触发条件类型
//
// 【用途】
// - 决定控制器何时自动触发升降操作
// - 用于 CompProperties_ULS_AutoGroupMarker 配置
//
// 【类型说明】
// - Friendly: 友方单位接近时触发
// - Hostile: 敌对单位接近时触发
// - Neutral: 中立单位接近时触发
// ============================================================
public enum ULS_AutoGroupType
{
    // 友方触发
    // 当友方 Pawn（殖民者、盟友）进入检测范围时触发
    Friendly,

    // 敌对触发
    // 当敌对 Pawn（入侵者、野兽）进入检测范围时触发
    Hostile,

    // 中立触发
    // 当中立 Pawn（商队、访客）进入检测范围时触发
    Neutral
}

// ============================================================
// 【自动分组标记组件属性】
// ============================================================
// 此类定义了自动分组标记组件的配置参数
//
// 【继承关系】
// - 继承自 CompProperties：RimWorld 的组件属性基类
//
// 【核心职责】
// 1. 定义自动分组的触发条件和检测参数
// 2. 配置检测范围、检测间隔和延迟时间
// 3. 通过 XML 定义不同建筑的自动化行为
//
// 【使用场景】
// - 在 XML 中配置自动门、自动防御系统等建筑
// - 控制器通过此属性判断是否需要自动升降
//
// 【XML 配置示例】
// <comps>
//   <li Class="Universal_Lift_Structure.CompProperties_ULS_AutoGroupMarker">
//     <autoGroupType>Friendly</autoGroupType>
//     <maxRadius>5</maxRadius>
//     <checkIntervalTicks>60</checkIntervalTicks>
//   </li>
// </comps>
// ============================================================
public class CompProperties_ULS_AutoGroupMarker : CompProperties
{
    // ============================================================
    // 【配置字段】
    // ============================================================
    // 这些字段可以在 XML 中配置，定义自动分组的行为
    // ============================================================

    // 自动分组触发类型
    // 默认值：Friendly（友方触发）
    // 用途：决定哪种类型的 Pawn 会触发自动升降
    public ULS_AutoGroupType autoGroupType = ULS_AutoGroupType.Friendly;

    // 最大检测半径
    // 默认值：2 格
    // 用途：定义从控制器开始的检测范围
    // 注意：检测范围越大，性能开销越大
    public int maxRadius = 2;

    // 检测间隔（Tick）
    // 默认值：60 ticks（1 秒）
    // 用途：控制多久检测一次周围的 Pawn
    // 优化建议：间隔越长，CPU 开销越小，但响应越慢
    public int checkIntervalTicks = 60;

    // 关闭延迟（Tick）
    // 默认值：120 ticks（2 秒）
    // 用途：Pawn 离开检测范围后，延迟多久才关闭（降下）
    // 设计目的：防止 Pawn 在范围边缘反复进出导致频繁开关
    public int closeDelayTicks = 120;

    // 切换冷却时间（Tick）
    // 默认值：60 ticks（1 秒）
    // 用途：两次升降操作之间的最小间隔
    // 设计目的：防止频繁切换状态，提高稳定性
    public int toggleCooldownTicks = 60;

    // ============================================================
    // 【构造函数】
    // ============================================================

    /// 默认构造函数
    /// 用途：
    ///   1. 在 XML 解析时被调用
    ///   2. 设置 compClass 字段，指定实际的组件类
    ///
    /// 【重要】
    /// - compClass 必须设置为 typeof(ULS_AutoGroupMarker)
    /// - 这样 RimWorld 才能正确实例化组件
    public CompProperties_ULS_AutoGroupMarker()
    {
        // 指定组件的实际类型
        compClass = typeof(ULS_AutoGroupMarker);
    }
}

// ============================================================
// 【自动分组标记组件】
// ============================================================
// 此类是附加到建筑上的实际组件，提供自动分组功能
//
// 【继承关系】
// - 继承自 ThingComp：RimWorld 的组件基类
//
// 【核心职责】
// 1. 读取配置参数（通过 Props 属性）
// 2. 检测周围的 Pawn 并触发自动升降
// 3. 管理冷却时间和延迟逻辑
//
// 【使用方式】
// - 通过 XML 中的 <comps> 标签附加到建筑定义
// - 控制器会检查是否有此组件，并根据配置执行自动逻辑
//
// 【注意】
// - 当前实现仅定义了基础结构
// - 实际的检测和触发逻辑在 ULS_AutoGroupMapComponent 中实现
// - 此组件主要作为标记和配置容器
// ============================================================
public class ULS_AutoGroupMarker : ThingComp
{
    // ============================================================
    // 【属性】
    // ============================================================

    /// 配置属性访问器
    /// 用途：提供类型安全的方式访问组件配置
    /// 返回：CompProperties_ULS_AutoGroupMarker 类型的配置对象
    ///
    /// 【工作原理】
    /// - props 是基类 ThingComp 中的字段（类型为 CompProperties）
    /// - 此属性将其强制转换为具体的配置类型
    /// - 使用 =\u003e 语法定义只读属性（表达式体成员）
    public CompProperties_ULS_AutoGroupMarker Props => (CompProperties_ULS_AutoGroupMarker)props;

    // ============================================================
    // 【潜在扩展点】
    // ============================================================
    // 如果需要在组件中添加运行时状态，可以在此处添加字段
    // 例如：
    // - private int lastCheckTick; // 上次检测的 Tick
    // - private Pawn lastDetectedPawn; // 上次检测到的 Pawn
    // - private bool isTriggered; // 是否已触发
    //
    // 如果需要序列化这些状态，需要重写 ExposeData() 方法
    // ============================================================
}